Technical Blueprint: Pixel Art Shifter2.1 GoalThe objective is to develop a single-file, browser-based React application that leverages Multimodal Generative AI (Google Gemini) to transform a user-uploaded pixel art reference into a consistent, multi-view game sprite sheet. The tool automates character design consistency and utilizes a vision-based verification loop to ensure generated poses (idle, walk, attack) match specific directional and action requirements.2.2 OverviewThe application follows a linear 3-step workflow:Configuration: User defines character attributes (Race, Role, Armor, Weapon) and uploads a style reference image.Concept Visualization: The system generates a "Source of Truth" character concept using Image-to-Image generation, applying the configuration to the reference style.Sprite Sheet Generation: The system generates 17 specific sprite poses using the Concept Image as the visual reference. A self-correcting mechanism uses a Vision model to verify the output (e.g., "Is it facing left?") and retries automatically if the generation is incorrect.2.3 FeaturesAttribute Configuration: Dropdown/Text inputs for Race, Role, Armor, and Weapon selection.Style Reference Upload: Drag-and-drop support for PNG/JPG pixel art images (max 4MB).Role Concept Generation:Uses gemini-2.5-flash-image-preview.Enforces solid green (#00ff00) background for chroma keying.Automated Sprite Sheet Generation (17 Views):Idle: Front, Left, Right, Back.Action: Hit/Damage.Locomotion: Walk Front (Left/Right leg), Walk Side (Left/Right).Combat: High Strike (Front/Left/Right/Back), Horizontal Swing (Front/Left/Right/Back).VFX: Combat prompts include specific instructions for energy waves and visual effects.Auto-Verification Loop:Uses gemini-2.5-flash-preview (Vision) to analyze generated images against criteria.Automatic retry (up to 3 attempts) if verification fails.Robust Error Handling: Exponential backoff for API 401/429 errors.Export: Individual download buttons for every generated sprite.2.4 Key Algorithms2.4.1 Exponential Backoff (API Stability)To handle API rate limits or transient auth errors:Define maxRetries = 5.Start delay = 1000ms.Loop i from 0 to maxRetries:Attempt fetch.If success (response.ok), return response.If status is 401, 429, 500, or 503:Wait delay.delay = delay * 2.Retry.If other error or retries exhausted, throw Error.2.4.2 Verification Loop (Self-Correction)For a specific poseId:Set state to 'generating'.Attempt Loop (Max 3 iterations):Generate: Call Image-to-Image API with promptSuffix + ConceptImage (Base64).Verify: Call Vision API with generated image + verifyCriteria.If Verification returns true:Save image to state.Break loop (Success).If Verification returns false:Set state to 'retrying'.Append "IMPORTANT: Previous generation was incorrect..." to prompt.Continue to next iteration.If loop finishes without success, throw error.2.5 Complete Function ListApp Component: Main entry point.handleFileChange(e): Validates and reads the uploaded reference file.validateAndSetConceptFile(file): Helper for validation logic (size/type).fileToBase64(file): Promisified FileReader to convert Blob to Base64 string (stripping metadata header).fetchWithRetry(url, options, maxRetries): Wrapper for fetch implementing Algorithm 2.4.1.generateRoleConcept(): Orchestrates Step 2 (Concept Generation).verifyImage(base64, criteria): Calls Vision API to validate image content (returns boolean).generatePose(poseId): Orchestrates Step 3 (Generation + Verification Loop) for a single pose.generateAll(): Iterates through POSES_CONFIG and triggers generatePose for all IDs.clearAll(): Resets all state variables.2.6 Data Structures2.6.1 POSES_CONFIG SchemaArray of objects defining the sprite sheet requirements:{
  id: string,           // Unique identifier (e.g., 'walk-side-l')
  label: string,        // UI Label (e.g., '行走 (左)')
  promptSuffix: string, // Specific visual instruction for generation
  verifyCriteria: string // Question for the Vision model (e.g., "Is facing LEFT?")
}
2.6.2 State ManagementconceptFile: File object (Reference).roleConceptUrl: String (Base64 data URL of the generated concept).generatedPoses: Object { [poseId]: string (Base64 URL) }.loadingPoses: Object { [poseId]: string (status message) }.2.7 Implementation Details2.7.1 CLI & UsageEnvironment: Browser (React).Interaction Flow:Left Panel: Select dropdowns for Race, Role, etc.Center Panel: Click upload area to select file -> Click "Generate Concept".Bottom Panel: Wait for Concept -> Click "Generate All" OR click individual "+" buttons on grid slots.2.8 Function FlowchartsSprite Generation Flow:[Start: generatePose(id)]
       |
       v
[Check: roleConceptUrl exists?] --No--> [Error Alert]
       |
       v
[Loop: i = 0 to 2] <-----------------------+
       |                                   |
[API: Generate Image (Gemini Img2Img)]     |
       |                                   |
[API: Verify Image (Gemini Vision)]        |
       |                                   |
[Is Valid?] --No--> [Update Status: Retry]-+
       |
      Yes
       |
[Update State: generatedPoses[id]]
       |
[End]
2.9 Comprehensive Error HandlingFile Validation: Reject non-image types; reject files > 4MB.API Auth: Catch 401 errors via fetchWithRetry.Safety Blocks: Handle finishReason === 'SAFETY' from Gemini API.Empty Response: Handle cases where API returns success but no image data.Vision Failure: If Vision API fails (network/json parse), default to true (fail-open) to avoid blocking users due to validation service errors.2.10 Key Implementation PatternsSingle-File Component: All logic contained within App for portability.Inline SVG Icons: Replaced lucide-react dynamic imports with direct <svg> rendering to prevent NotFoundError DOM conflicts in CDN environments.Prompt Engineering: Use of "CRITICAL" keyword and specific hex codes (#00ff00) to enforce constraints.2.11 File Format SpecificationsInput: image/png, image/jpeg.Internal: Base64 Data URLs.Output: Downloadable .png files.2.12 DependenciesReact: v18 (via CDN unpkg).ReactDOM: v18 (via CDN unpkg).Babel: Standalone (via CDN unpkg).Tailwind CSS: (via CDN).Lucide Icons: (Replaced by internal SVG mapping).2.13 Testing & Validation2.13.1 Test CasesAPI Resilience: Disconnect network during generation. Expect: Retry loop, then error message.Consistency: Generate "Front" and "Back" views. Ensure armor colors match the Concept image.Directionality: Generate "Left" view. Ensure character faces left. (Vision model should catch failures).Effects: Generate "Attack". Ensure glowing energy waves are present.Green Screen: Sample generated image pixels at (0,0). Expect: #00ff00.2.14 Implementation ConsiderationsPerformance: Generating 17 images simultaneously might rate-limit the API key. The UI allows individual generation if "Generate All" fails partly.Cost: "Verify" step doubles the API calls per successful image.Security: API Key is currently hardcoded or empty string in the script. In production, this should be proxied.2.15 Implementation Status[✅] COMPLETEModification LogTimestamp: 2026-02-14 23:30Modification: Added fetchWithRetry logic.Purpose: Fix 401 errors reported by user.Impact: Updated Section 2.4.1 and 2.5.Timestamp: 2026-02-14 23:30Modification: Expanded POSES_CONFIG to 17 items including 8 specific combat poses.Purpose: User request for detailed attack animations.Impact: Updated Section 2.6.1.Timestamp: 2026-02-14 23:45Modification: Replaced lucide-react dynamic component with custom Icon component returning inline SVGs.Purpose: Fix NotFoundError: Failed to execute 'removeChild' caused by React/DOM sync issues with the Lucide CDN script.Impact: Updated Section 2.10 and 2.12.Timestamp: 2026-02-14 23:45Modification: Enhanced prompts for attack poses.Purpose: User request for "attack waves" (VFX).Impact: Updated Section 2.6.1 (promptSuffix).